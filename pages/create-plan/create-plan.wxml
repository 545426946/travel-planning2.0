<view class="container">
  <view class="page-header">
    <text class="page-title">{{isEdit ? 'ç¼–è¾‘è¡Œç¨‹' : 'åˆ›å»ºè¡Œç¨‹'}}</text>
    <text class="page-subtitle">è§„åˆ’ä½ çš„å®Œç¾æ—…ç¨‹</text>
  </view>

  <view class="form-container">
    <!-- è¡Œç¨‹æ ‡é¢˜ -->
    <view class="form-section">
      <view class="form-label required">
        <text>è¡Œç¨‹æ ‡é¢˜</text>
      </view>
      <input 
        class="form-input {{errors.title ? 'error' : ''}}"
        placeholder="ç»™ä½ çš„æ—…è¡Œèµ·ä¸ªåå­—"
        value="{{formData.title}}"
        data-field="title"
        bindinput="onInputChange"
        maxlength="50"
      />
      <view wx:if="{{errors.title}}" class="error-text">{{errors.title}}</view>
    </view>

    <!-- ç›®çš„åœ° -->
    <view class="form-section">
      <view class="form-label required">
        <text>ç›®çš„åœ°</text>
      </view>
      <input 
        class="form-input {{errors.destination ? 'error' : ''}}"
        placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬ã€äº‘å—å¤§ç†"
        value="{{formData.destination}}"
        data-field="destination"
        bindinput="onInputChange"
        maxlength="30"
      />
      <view wx:if="{{errors.destination}}" class="error-text">{{errors.destination}}</view>
    </view>

    <!-- æ—¥æœŸé€‰æ‹© -->
    <view class="form-section">
      <view class="form-label required">
        <text>å‡ºè¡Œæ—¥æœŸ</text>
      </view>
      <view class="date-row">
        <view class="date-picker">
          <text class="date-label">å¼€å§‹</text>
          <picker 
            mode="date" 
            value="{{formData.startDate}}"
            start="{{minDate}}"
            data-field="startDate"
            bindchange="onDateChange"
          >
            <view class="picker-value {{errors.startDate ? 'error' : ''}}">
              {{formData.startDate || 'é€‰æ‹©æ—¥æœŸ'}}
            </view>
          </picker>
        </view>
        
        <text class="date-separator">è‡³</text>
        
        <view class="date-picker">
          <text class="date-label">ç»“æŸ</text>
          <picker 
            mode="date" 
            value="{{formData.endDate}}"
            start="{{formData.startDate || minDate}}"
            data-field="endDate"
            bindchange="onDateChange"
          >
            <view class="picker-value {{errors.endDate ? 'error' : ''}}">
              {{formData.endDate || 'é€‰æ‹©æ—¥æœŸ'}}
            </view>
          </picker>
        </view>
      </view>
      <view wx:if="{{errors.startDate || errors.endDate}}" class="error-text">
        {{errors.startDate || errors.endDate}}
      </view>
    </view>

    <!-- å‡ºè¡Œäººæ•° -->
    <view class="form-section">
      <view class="form-label">
        <text>å‡ºè¡Œäººæ•°</text>
      </view>
      <view class="number-input">
        <text class="number-label">{{formData.travelers}}äºº</text>
        <slider 
          value="{{formData.travelers}}"
          min="1"
          max="20"
          step="1"
          show-value
          bindchange="onTravelersChange"
          activeColor="#4A90E2"
        />
      </view>
    </view>

    <!-- é¢„ç®— -->
    <view class="form-section">
      <view class="form-label required">
        <text>é¢„ç®—ï¼ˆå…ƒï¼‰</text>
      </view>
      <input 
        class="form-input {{errors.budget ? 'error' : ''}}"
        type="digit"
        placeholder="é¢„è®¡æ€»é¢„ç®—"
        value="{{formData.budget}}"
        data-field="budget"
        bindinput="onInputChange"
      />
      <view wx:if="{{errors.budget}}" class="error-text">{{errors.budget}}</view>
    </view>

    <!-- æ—…è¡Œé£æ ¼ -->
    <view class="form-section">
      <view class="form-label">
        <text>æ—…è¡Œé£æ ¼</text>
      </view>
      <picker 
        mode="selector"
        range="{{styleOptions}}"
        range-key="label"
        value="{{selectedStyleIndex}}"
        bindchange="onStyleChange"
      >
        <view class="picker-display">
          <text>{{styleOptions[selectedStyleIndex].label}}</text>
          <text class="arrow">â–¼</text>
        </view>
      </picker>
    </view>

    <!-- æ ‡ç­¾ -->
    <view class="form-section">
      <view class="form-label">
        <text>è¡Œç¨‹æ ‡ç­¾</text>
      </view>
      <view class="tags-selector">
        <view 
          wx:for="{{commonTags}}" 
          wx:key="index"
          class="tag-item {{formData.tags.includes(item) ? 'selected' : ''}}"
          data-tag="{{item}}"
          bindtap="toggleTag"
        >
          <text>{{item}}</text>
        </view>
        <view class="tag-item add-tag" bindtap="addCustomTag">
          <text>+ è‡ªå®šä¹‰</text>
        </view>
      </view>
    </view>

    <!-- è¡Œç¨‹æè¿° -->
    <view class="form-section">
      <view class="form-label">
        <text>è¡Œç¨‹æè¿°</text>
      </view>
      <textarea 
        class="form-textarea"
        placeholder="ç®€å•æè¿°ä¸€ä¸‹è¿™æ¬¡æ—…è¡Œçš„è®¡åˆ’..."
        value="{{formData.description}}"
        data-field="description"
        bindinput="onInputChange"
        maxlength="500"
        auto-height
      />
    </view>

    <!-- äº¤é€šæ–¹å¼ -->
    <view class="form-section">
      <view class="form-label">
        <text>äº¤é€šæ–¹å¼</text>
      </view>
      <input 
        class="form-input"
        placeholder="ä¾‹å¦‚ï¼šé«˜é“ã€é£æœºã€è‡ªé©¾"
        value="{{formData.transportation}}"
        data-field="transportation"
        bindinput="onInputChange"
        maxlength="50"
      />
    </view>

    <!-- ä½å®¿å®‰æ’ -->
    <view class="form-section">
      <view class="form-label">
        <text>ä½å®¿å®‰æ’</text>
      </view>
      <input 
        class="form-input"
        placeholder="ä¾‹å¦‚ï¼šé…’åº—ã€æ°‘å®¿"
        value="{{formData.accommodation}}"
        data-field="accommodation"
        bindinput="onInputChange"
        maxlength="50"
      />
    </view>

    <!-- ç‰¹æ®Šè¦æ±‚ -->
    <view class="form-section">
      <view class="form-label">
        <text>ç‰¹æ®Šè¦æ±‚</text>
      </view>
      <textarea 
        class="form-textarea"
        placeholder="æœ‰ä»€ä¹ˆç‰¹æ®Šéœ€æ±‚æˆ–æ³¨æ„äº‹é¡¹å—ï¼Ÿ"
        value="{{formData.specialRequirements}}"
        data-field="specialRequirements"
        bindinput="onInputChange"
        maxlength="300"
        auto-height
      />
    </view>

    <!-- æ¯æ—¥è¡Œç¨‹ç¼–è¾‘ï¼ˆä»…ç¼–è¾‘æ¨¡å¼æ˜¾ç¤ºï¼‰ -->
    <view wx:if="{{isEdit && dailyItinerary.length > 0}}" class="form-section itinerary-section">
      <view class="form-label">
        <text>ğŸ“… æ¯æ—¥è¡Œç¨‹å®‰æ’</text>
      </view>
      
      <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
      <scroll-view class="day-selector" scroll-x>
        <view class="day-tabs">
          <view wx:for="{{dailyItinerary}}" 
                wx:key="day"
                class="day-tab {{selectedDay === item.day ? 'active' : ''}}"
                bindtap="selectDay"
                data-day="{{item.day}}">
            <text class="day-num">ç¬¬{{item.day}}å¤©</text>
            <text class="day-date">{{item.date}}</text>
            <text class="activity-count">{{item.activities.length}}é¡¹</text>
          </view>
        </view>
      </scroll-view>

      <!-- å½“å¤©æ´»åŠ¨åˆ—è¡¨ -->
      <view wx:for="{{dailyItinerary}}" wx:key="day" wx:if="{{item.day === selectedDay}}" wx:for-index="dayIdx">
        <view class="day-activities">
          <!-- æ·»åŠ æ´»åŠ¨æŒ‰é’® -->
          <view class="add-activity-btn" bindtap="showAddActivity">
            <text class="icon">â•</text>
            <text>æ·»åŠ æ´»åŠ¨</text>
          </view>

          <!-- æ´»åŠ¨åˆ—è¡¨ -->
          <view wx:if="{{item.activities.length > 0}}" class="activities-list">
            <view wx:for="{{item.activities}}" 
                  wx:key="index" 
                  wx:for-item="activity"
                  wx:for-index="actIdx"
                  class="activity-item">
              <view class="activity-info">
                <text class="activity-time">{{activity.time}}</text>
                <view class="activity-detail">
                  <text class="activity-title">{{activity.title}}</text>
                  <text wx:if="{{activity.location}}" class="activity-location">ğŸ“ {{activity.location}}</text>
                  <text wx:if="{{activity.price}}" class="activity-price">ğŸ’° {{activity.price}}å…ƒ</text>
                </view>
              </view>
              <view class="activity-actions">
                <text class="delete-btn" catchtap="deleteActivityFromDay" 
                      data-day-index="{{dayIdx}}" data-activity-index="{{actIdx}}">ğŸ—‘ï¸</text>
              </view>
            </view>
          </view>

          <!-- ç©ºçŠ¶æ€ -->
          <view wx:else class="empty-activities">
            <text class="empty-icon">ğŸ“­</text>
            <text class="empty-text">æš‚æ— æ´»åŠ¨ï¼Œç‚¹å‡»ä¸Šæ–¹æ·»åŠ </text>
          </view>
        </view>
      </view>
    </view>

    <!-- åˆå§‹åŒ–è¡Œç¨‹æŒ‰é’®ï¼ˆç¼–è¾‘æ¨¡å¼ä¸”æ— è¡Œç¨‹æ—¶æ˜¾ç¤ºï¼‰ -->
    <view wx:if="{{isEdit && dailyItinerary.length === 0 && formData.startDate && formData.endDate}}" class="form-section">
      <button class="init-itinerary-btn" bindtap="initDailyItinerary">
        <text>ğŸ“… å¼€å§‹è§„åˆ’æ¯æ—¥è¡Œç¨‹</text>
      </button>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="form-actions">
      <button 
        class="submit-btn"
        bindtap="submitForm"
        disabled="{{submitting}}"
        loading="{{submitting}}"
      >
        <text>{{isEdit ? 'ä¿å­˜ä¿®æ”¹' : 'åˆ›å»ºè¡Œç¨‹'}}</text>
      </button>
      
      <button 
        wx:if="{{!isEdit}}"
        class="reset-btn"
        bindtap="resetForm"
        disabled="{{submitting}}"
      >
        <text>é‡ç½®è¡¨å•</text>
      </button>
    </view>
  </view>

  <!-- æ·»åŠ æ´»åŠ¨å¼¹çª— -->
  <view wx:if="{{showAddActivityModal}}" class="modal-overlay" catchtap="hideAddActivityModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">æ·»åŠ æ´»åŠ¨</text>
        <text class="modal-close" bindtap="hideAddActivityModal">âœ•</text>
      </view>
      
      <view class="modal-body">
        <view class="modal-form-item">
          <text class="modal-label">æ—¶é—´</text>
          <picker mode="time" value="{{newActivity.time}}" bindchange="onActivityTimeChange">
            <view class="modal-picker">{{newActivity.time}}</view>
          </picker>
        </view>
        
        <view class="modal-form-item">
          <text class="modal-label">æ´»åŠ¨åç§° *</text>
          <input class="modal-input" value="{{newActivity.title}}" 
                 data-field="title" bindinput="onNewActivityInput" 
                 placeholder="ä¾‹å¦‚ï¼šå‚è§‚æ•…å®«åšç‰©é™¢" />
        </view>
        
        <view class="modal-form-item">
          <text class="modal-label">åœ°ç‚¹</text>
          <input class="modal-input" value="{{newActivity.location}}" 
                 data-field="location" bindinput="onNewActivityInput" 
                 placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬å¸‚ä¸œåŸåŒº" />
        </view>
        
        <view class="modal-form-item">
          <text class="modal-label">è´¹ç”¨ï¼ˆå…ƒï¼‰</text>
          <input class="modal-input" type="digit" value="{{newActivity.price}}" 
                 data-field="price" bindinput="onNewActivityInput" 
                 placeholder="ä¾‹å¦‚ï¼š60" />
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideAddActivityModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="addActivityToDay">æ·»åŠ </button>
      </view>
    </view>
  </view>
</view>
