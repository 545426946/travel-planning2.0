<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- è¡Œç¨‹è¯¦æƒ… -->
  <view wx:else class="plan-detail">
    <!-- è¿”å›æŒ‰é’® -->
    <view class="back-button" bindtap="navigateBack">
      <text>â† è¿”å›è¡Œç¨‹åˆ—è¡¨</text>
    </view>

    <!-- å¤´éƒ¨ä¿¡æ¯ -->
    <view class="plan-header">
      <image class="header-image" src="{{plan.image}}" mode="aspectFill" />
      
      <view class="header-overlay">
        <view class="header-content">
          <text class="plan-title">{{plan.title}}</text>
          
          <view class="plan-badges">
            <view wx:if="{{plan.isAIGenerated}}" class="badge ai-badge">
              <text>ğŸ¤– AIç”Ÿæˆ</text>
            </view>
            <view class="badge status-badge">
              <text>{{getStatusText(plan.status)}}</text>
            </view>
          </view>

          <view class="plan-meta">
            <view class="meta-row">
              <view class="meta-item">
                <text class="icon">ğŸ“…</text>
                <text>è¡Œç¨‹å¤©æ•°ï¼š{{plan.totalDays}}å¤©</text>
              </view>
              <view class="meta-item">
                <text class="icon">ğŸ‘¥</text>
                <text>å‡ºè¡Œäººæ•°ï¼š{{plan.travelers}}äºº</text>
              </view>
            </view>
            <view class="meta-row">
              <view class="meta-item">
                <text class="icon">ğŸ’°</text>
                <text>é¢„ç®—ï¼šÂ¥{{plan.budget}}</text>
              </view>
              <view class="meta-item">
                <text class="icon">ğŸ“</text>
                <text>ç›®çš„åœ°ï¼š{{plan.destination}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-bar">
      <button class="action-btn" bindtap="editPlan">
        <text class="icon">âœï¸</text>
        <text>ç¼–è¾‘</text>
      </button>
      <button class="action-btn" bindtap="changeStatus">
        <text class="icon">ğŸ”„</text>
        <text>çŠ¶æ€</text>
      </button>
      <button class="action-btn" bindtap="duplicatePlan">
        <text class="icon">ğŸ“‹</text>
        <text>å¤åˆ¶</text>
      </button>
      <button class="action-btn" bindtap="showMoreActions">
        <text class="icon">â‹¯</text>
        <text>æ›´å¤š</text>
      </button>
    </view>

    <!-- è¡Œç¨‹å®‰æ’ -->
    <view class="itinerary-section">
      <view class="section-title">è¡Œç¨‹å®‰æ’</view>
      
      <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
      <scroll-view class="day-selector" scroll-x>
        <view class="day-tabs">
          <view wx:for="{{dailyItinerary}}" 
                wx:key="day"
                class="day-tab {{selectedDay === item.day ? 'active' : ''}}"
                bindtap="selectDay"
                data-day="{{item.day}}">
            <text class="day-label">ç¬¬{{item.day}}å¤©</text>
            <text class="day-date">{{item.date}}</text>
          </view>
        </view>
      </scroll-view>

      <!-- æ¯æ—¥è¯¦æƒ… -->
      <view wx:for="{{dailyItinerary}}" wx:key="day" wx:if="{{item.day === selectedDay}}">
        <view class="daily-content">
          <!-- å¦‚æœæœ‰ç»“æ„åŒ–çš„æ´»åŠ¨ -->
          <view wx:if="{{item.activities && item.activities.length > 0}}" class="activities-list">
            <view wx:for="{{item.activities}}" 
                  wx:key="index" 
                  wx:for-item="activity"
                  class="activity-card">
              <view class="activity-time-bar">
                <text class="time-label">{{activity.time}}</text>
              </view>
              
              <view class="activity-content">
                <view class="activity-header">
                  <text class="activity-title">{{activity.title}}</text>
                  <view wx:if="{{activity.price}}" class="activity-price">
                    <text>Â¥{{activity.price}}</text>
                  </view>
                </view>
                
                <view wx:if="{{activity.location}}" class="activity-location">
                  <text class="icon">ğŸ“</text>
                  <text>{{activity.location}}</text>
                </view>
              </view>
            </view>
          </view>

          <!-- å¦‚æœæ²¡æœ‰ç»“æ„åŒ–çš„æ´»åŠ¨ï¼Œæ˜¾ç¤ºåŸå§‹å†…å®¹ -->
          <view wx:else class="raw-content">
            <text>{{item.content}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- è¡Œç¨‹æè¿° -->
    <view wx:if="{{plan.description}}" class="description-section">
      <view class="section-title">è¡Œç¨‹æè¿°</view>
      <text class="description-text">{{plan.description}}</text>
    </view>

    <!-- æ—…è¡Œé£æ ¼ -->
    <view wx:if="{{plan.travelStyle}}" class="info-section">
      <view class="section-title">æ—…è¡Œé£æ ¼</view>
      <view class="info-tag">
        <text>{{getTravelStyleText(plan.travelStyle)}}</text>
      </view>
    </view>

    <!-- å…´è¶£åå¥½ -->
    <view wx:if="{{plan.interests && plan.interests.length > 0}}" class="info-section">
      <view class="section-title">å…´è¶£åå¥½</view>
      <view class="tags-container">
        <view wx:for="{{plan.interests}}" wx:key="index" class="info-tag">
          <text>{{item.label || item}}</text>
        </view>
      </view>
    </view>

    <!-- æ ‡ç­¾ -->
    <view wx:if="{{plan.tags && plan.tags.length > 0}}" class="info-section">
      <view class="section-title">è¡Œç¨‹æ ‡ç­¾</view>
      <view class="tags-container">
        <view wx:for="{{plan.tags}}" wx:key="index" class="info-tag">
          <text>{{item}}</text>
        </view>
      </view>
    </view>

    <!-- äº¤é€šå’Œä½å®¿ -->
    <view class="logistics-section">
      <view wx:if="{{plan.transportation}}" class="logistics-item">
        <view class="section-title">äº¤é€šæ–¹å¼</view>
        <text class="logistics-text">{{plan.transportation}}</text>
      </view>
      
      <view wx:if="{{plan.accommodation}}" class="logistics-item">
        <view class="section-title">ä½å®¿å®‰æ’</view>
        <text class="logistics-text">{{plan.accommodation}}</text>
      </view>
    </view>

    <!-- ç‰¹æ®Šè¦æ±‚ -->
    <view wx:if="{{plan.specialRequirements}}" class="info-section">
      <view class="section-title">ç‰¹æ®Šè¦æ±‚</view>
      <text class="description-text">{{plan.specialRequirements}}</text>
    </view>

    <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
    <view class="bottom-actions">
      <button class="bottom-btn primary-btn" bindtap="editPlan">
        <text>ç¼–è¾‘è¡Œç¨‹</text>
      </button>
      <button class="bottom-btn secondary-btn" bindtap="showMoreActions">
        <text>æ›´å¤šæ“ä½œ</text>
      </button>
    </view>
  </view>
</view>
