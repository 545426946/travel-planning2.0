<!-- pages/login/login.wxml -->
<view class="container">
  <!-- 顶部装饰 -->
  <view class="header-decoration">
    <view class="decoration-circle circle-1"></view>
    <view class="decoration-circle circle-2"></view>
  </view>

  <!-- 主要内容区域 -->
  <view class="main-content">
    <!-- Logo 和标题 -->
  <view class="logo-section">
    <image class="logo" src="/pages/image/logo.png" mode="aspectFit" binderror="onImageError"></image>
    <text class="app-name">轻松旅行规划</text>
    <text class="app-slogan">让旅行更简单，让体验更精彩</text>
  </view>

  <!-- 常驻微信登录按钮（上移到顶部，确保可见） -->
  <view class="wechat-login">
    <button 
      class="login-btn wechat-btn primary" 
      open-type="getUserInfo"
      bindgetuserinfo="handleWechatLoginWithUserInfo"
      loading="{{isLoading}}"
      disabled="{{isLoading}}"
      hover-class="button-hover"
    >
      <text class="wechat-logo">🟢</text>
      {{isLoading ? '登录中...' : '使用微信登录'}}
    </button>
  </view>

    <!-- 登录方式切换 -->
    <view class="login-type-switch">
      <view 
        class="switch-item {{loginType == 0 ? 'active' : ''}}" 
        bindtap="switchLoginType" 
        data-type="0"
      >
        <text class="switch-icon">👤</text>
        <text>账号登录</text>
      </view>
      <view 
        class="switch-item {{loginType == 1 ? 'active' : ''}}" 
        bindtap="switchLoginType" 
        data-type="1"
      >
        <text class="switch-icon">📱</text>
        <text>微信登录</text>
      </view>
    </view>

    <!-- 账号密码登录表单 -->
    <view class="login-form" wx:if="{{loginType == 0}}">
      <!-- 用户名输入 -->
      <view class="form-group">
        <view class="input-wrapper {{formErrors.username ? 'error' : ''}}">
          <text class="input-icon">👤</text>
          <input 
            class="form-input" 
            type="text" 
            placeholder="用户名/邮箱/手机号"
            value="{{formData.username}}"
            bindinput="onInput"
            data-field="username"
            maxlength="50"
          />
        </view>
        <text class="error-text" wx:if="{{formErrors.username}}">{{formErrors.username}}</text>
      </view>

      <!-- 密码输入 -->
      <view class="form-group">
        <view class="input-wrapper {{formErrors.password ? 'error' : ''}}">
          <text class="input-icon">🔒</text>
          <input 
            class="form-input" 
            type="{{showPassword ? 'text' : 'password'}}" 
            placeholder="请输入密码"
            value="{{formData.password}}"
            bindinput="onInput"
            data-field="password"
            maxlength="50"
          />
          <text class="password-toggle" bindtap="togglePassword">
            {{showPassword ? '👁️' : '👁️‍🗨️'}}
          </text>
        </view>
        <text class="error-text" wx:if="{{formErrors.password}}">{{formErrors.password}}</text>
      </view>

      <!-- 记住我 & 忘记密码 -->
      <view class="form-options">
        <view class="remember-me" bindtap="toggleRemember">
          <view class="checkbox {{rememberMe ? 'checked' : ''}}">
            <text wx:if="{{rememberMe}}">✓</text>
          </view>
          <text class="remember-text">记住我</text>
        </view>
        <text class="forgot-password" bindtap="forgotPassword">忘记密码？</text>
      </view>

      <!-- 登录按钮 -->
      <button 
        class="login-btn account-btn" 
        bindtap="accountLogin"
        loading="{{isLoading}}"
        disabled="{{isLoading}}"
      >
        {{isLoading ? '登录中' : '登录'}}
      </button>

      <!-- 注册链接 -->
      <view class="register-link">
        <text>还没有账号？</text>
        <text class="register-text" bindtap="goToRegister">立即注册</text>
      </view>
    </view>

    <!-- 微信登录区域 -->
    <view class="wechat-login" wx:if="{{loginType == 1}}">
      <view class="wechat-tips">
        <text class="tips-icon">🔐</text>
        <text class="tips-text">微信登录安全快捷</text>
      </view>

      <button 
        class="login-btn wechat-btn primary" 
        open-type="getUserInfo"
        bindgetuserinfo="handleWechatLoginWithUserInfo"
        loading="{{isLoading}}"
        disabled="{{isLoading}}"
        hover-class="button-hover"
      >
        <text class="wechat-logo">🟢</text>
        {{isLoading ? '登录中...' : '微信授权登录'}}
      </button>

      <button 
        class="login-btn wechat-btn secondary" 
        bindtap="wechatLoginWithProfile"
        loading="{{isLoading}}"
        disabled="{{isLoading}}"
        hover-class="button-hover"
      >
        <text class="wechat-logo">🟢</text>
        {{isLoading ? '登录中...' : '微信资料登录'}}
      </button>

      <!-- 微信登录说明 -->
      <view class="wechat-desc">
        <text class="auth-hint">🔐 可选择授权登录或资料登录</text>
        <text class="auth-hint">📱 开发工具受限时用“微信资料登录”</text>
        <text>登录即表示同意</text>
        <text class="link-text" bindtap="viewUserAgreement">《用户协议》</text>
        <text>和</text>
        <text class="link-text" bindtap="viewPrivacyPolicy">《隐私政策》</text>
      </view>
    </view>

    <!-- 其他登录方式 -->
    <view class="other-login">
      <view class="divider">
        <text class="divider-line"></text>
        <text class="divider-text">其他登录方式</text>
        <text class="divider-line"></text>
      </view>
      
      <view class="other-login-options">
        <view class="other-login-item">
          <text class="other-login-icon">📧</text>
          <text class="other-login-text">邮箱登录</text>
        </view>
        <view class="other-login-item">
          <text class="other-login-icon">📱</text>
          <text class="other-login-text">短信登录</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 底部装饰 -->
  <view class="footer-decoration">
    <text class="footer-text">© 2024 旅行规划 - 让旅行更美好</text>
  </view>
</view>
