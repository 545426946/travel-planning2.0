<!-- è¶³è¿¹åœ°å›¾ä¸»é¡µ -->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-mask">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stats-item">
      <text class="stats-num">{{stats.totalProvinces}}</text>
      <text class="stats-label">çœä»½</text>
    </view>
    <view class="stats-divider"></view>
    <view class="stats-item">
      <text class="stats-num">{{stats.totalCities}}</text>
      <text class="stats-label">åŸå¸‚</text>
    </view>
    <view class="stats-divider"></view>
    <view class="stats-item">
      <text class="stats-num">{{stats.totalAttractions}}</text>
      <text class="stats-label">è¶³è¿¹</text>
    </view>
    <view class="stats-divider"></view>
    <view class="stats-item">
      <text class="stats-num">{{stats.totalDistance > 9999 ? (stats.totalDistance / 10000).toFixed(1) + 'ä¸‡' : stats.totalDistance}}</text>
      <text class="stats-label">å…¬é‡Œ</text>
    </view>
  </view>

  <!-- Tabåˆ‡æ¢ -->
  <view class="tab-bar">
    <view class="tab-item {{currentTab === 'map' ? 'active' : ''}}" bindtap="switchTab" data-tab="map">
      <text class="tab-icon">ğŸ—ºï¸</text>
      <text class="tab-text">åœ°å›¾</text>
    </view>
    <view class="tab-item {{currentTab === 'list' ? 'active' : ''}}" bindtap="switchTab" data-tab="list">
      <text class="tab-icon">ğŸ“</text>
      <text class="tab-text">è¶³è¿¹</text>
    </view>
    <view class="tab-item {{currentTab === 'stats' ? 'active' : ''}}" bindtap="switchTab" data-tab="stats">
      <text class="tab-icon">ğŸ†</text>
      <text class="tab-text">æˆå°±</text>
    </view>
  </view>

  <!-- åœ°å›¾è§†å›¾ -->
  <view wx:if="{{currentTab === 'map'}}" class="map-container">
    <map
      id="footprintMap"
      class="map"
      latitude="{{latitude}}"
      longitude="{{longitude}}"
      scale="{{scale}}"
      markers="{{markers}}"
      polyline="{{polyline}}"
      show-location="{{true}}"
      enable-zoom="{{true}}"
      enable-scroll="{{true}}"
      bindmarkertap="onMarkerTap">
      
      <!-- åœ°å›¾å·¥å…·æ  -->
      <cover-view class="map-toolbar">
        <cover-view class="toolbar-btn" bindtap="locateMe">
          <cover-view class="btn-icon">ğŸ“</cover-view>
        </cover-view>
        <cover-view class="toolbar-btn" bindtap="showAllFootprints">
          <cover-view class="btn-icon">ğŸŒ</cover-view>
        </cover-view>
      </cover-view>
    </map>

    <!-- æ‰“å¡æŒ‰é’® -->
    <view class="checkin-btn" bindtap="goCheckin">
      <text class="checkin-icon">ğŸ“¸</text>
      <text class="checkin-text">æ‰“å¡</text>
    </view>
  </view>

  <!-- è¶³è¿¹åˆ—è¡¨è§†å›¾ -->
  <view wx:if="{{currentTab === 'list'}}" class="list-container">
    <scroll-view class="footprint-list" scroll-y>
      <!-- ç©ºçŠ¶æ€ -->
      <view wx:if="{{footprints.length === 0}}" class="empty-state">
        <text class="empty-icon">ğŸ—ºï¸</text>
        <text class="empty-title">è¿˜æ²¡æœ‰è¶³è¿¹</text>
        <text class="empty-desc">å»æ‰“å¡è®°å½•ä½ çš„ç¬¬ä¸€ä¸ªè¶³è¿¹å§</text>
        <button class="empty-btn" bindtap="goCheckin">ç«‹å³æ‰“å¡</button>
      </view>

      <!-- è¶³è¿¹åˆ—è¡¨ -->
      <view wx:for="{{footprints}}" wx:key="id" class="footprint-item" bindtap="onFootprintTap" data-index="{{index}}">
        <view class="fp-marker">
          <text class="fp-marker-icon">ğŸ“</text>
        </view>
        <view class="fp-content">
          <text class="fp-name">{{item.name}}</text>
          <view class="fp-meta">
            <text class="fp-location">{{item.city || item.province}}</text>
            <text class="fp-time">{{item.checkin_time}}</text>
          </view>
          <text wx:if="{{item.note}}" class="fp-note">{{item.note}}</text>
        </view>
        <view class="fp-arrow">â€º</view>
      </view>

      <!-- åº•éƒ¨æç¤º -->
      <view wx:if="{{footprints.length > 0}}" class="list-footer">
        <text>å…± {{footprints.length}} æ¡è¶³è¿¹</text>
      </view>
    </scroll-view>

    <!-- æ‰“å¡æŒ‰é’® -->
    <view class="checkin-btn fixed" bindtap="goCheckin">
      <text class="checkin-icon">ğŸ“¸</text>
      <text class="checkin-text">æ‰“å¡</text>
    </view>
  </view>

  <!-- æˆå°±è§†å›¾ -->
  <view wx:if="{{currentTab === 'stats'}}" class="stats-container">
    <scroll-view class="stats-scroll" scroll-y>
      <!-- çœä»½ç‚¹äº® -->
      <view class="section">
        <view class="section-header">
          <text class="section-title">ğŸ… çœä»½ç‚¹äº®</text>
          <text class="section-sub">{{stats.totalProvinces}}/34</text>
        </view>
        
        <view class="province-grid">
          <view 
            wx:for="{{provinces}}" 
            wx:key="code" 
            class="province-item {{visitedProvinces.indexOf(item.name) > -1 ? 'visited' : ''}}"
            bindtap="onProvinceTap"
            data-province="{{item}}">
            <text class="province-name">{{item.name}}</text>
          </view>
        </view>
      </view>

      <!-- æ—…è¡Œæ•°æ® -->
      <view class="section">
        <view class="section-header">
          <text class="section-title">ğŸ“Š æ—…è¡Œæ•°æ®</text>
        </view>
        
        <view class="data-cards">
          <view class="data-card">
            <text class="data-icon">ğŸš¶</text>
            <text class="data-value">{{stats.totalDistance}}</text>
            <text class="data-unit">å…¬é‡Œ</text>
            <text class="data-label">æ€»é‡Œç¨‹</text>
          </view>
          <view class="data-card">
            <text class="data-icon">ğŸ“</text>
            <text class="data-value">{{stats.totalAttractions}}</text>
            <text class="data-unit">ä¸ª</text>
            <text class="data-label">æ‰“å¡ç‚¹</text>
          </view>
          <view class="data-card">
            <text class="data-icon">ğŸ™ï¸</text>
            <text class="data-value">{{stats.totalCities}}</text>
            <text class="data-unit">åº§</text>
            <text class="data-label">åŸå¸‚</text>
          </view>
        </view>
      </view>

      <!-- æˆå°±å¾½ç«  -->
      <view class="section">
        <view class="section-header">
          <text class="section-title">ğŸ–ï¸ æˆå°±å¾½ç« </text>
        </view>
        
        <view class="badge-grid">
          <view class="badge-item {{stats.totalAttractions >= 1 ? 'unlocked' : ''}}">
            <text class="badge-icon">ğŸŒŸ</text>
            <text class="badge-name">åˆæ¬¡æ‰“å¡</text>
          </view>
          <view class="badge-item {{stats.totalAttractions >= 10 ? 'unlocked' : ''}}">
            <text class="badge-icon">ğŸ¯</text>
            <text class="badge-name">æ‰“å¡è¾¾äºº</text>
          </view>
          <view class="badge-item {{stats.totalCities >= 5 ? 'unlocked' : ''}}">
            <text class="badge-icon">ğŸƒ</text>
            <text class="badge-name">åŸå¸‚æ¢ç´¢è€…</text>
          </view>
          <view class="badge-item {{stats.totalProvinces >= 5 ? 'unlocked' : ''}}">
            <text class="badge-icon">ğŸ—ºï¸</text>
            <text class="badge-name">çœä»½æ”¶é›†å®¶</text>
          </view>
          <view class="badge-item {{stats.totalDistance >= 1000 ? 'unlocked' : ''}}">
            <text class="badge-icon">âœˆï¸</text>
            <text class="badge-name">åƒé‡Œä¹‹è¡Œ</text>
          </view>
          <view class="badge-item {{stats.totalProvinces >= 10 ? 'unlocked' : ''}}">
            <text class="badge-icon">ğŸ†</text>
            <text class="badge-name">æ—…è¡Œå¤§å¸ˆ</text>
          </view>
        </view>
      </view>

      <!-- åˆ†äº«æŒ‰é’® -->
      <button class="share-btn" open-type="share">
        <text class="share-icon">ğŸ“¤</text>
        <text>åˆ†äº«æˆ‘çš„è¶³è¿¹</text>
      </button>
    </scroll-view>
  </view>
</view>
