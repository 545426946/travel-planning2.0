<!-- æ‰“å¡é¡µé¢ -->
<view class="container">
  <!-- é¡¶éƒ¨æ  -->
  <view class="header">
    <view class="back-btn" bindtap="goBack">
      <text class="back-icon">â†</text>
    </view>
    <text class="header-title">æ‰“å¡</text>
    <view class="header-right"></view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-state">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ­£åœ¨è·å–ä½ç½®...</text>
  </view>

  <!-- ä¸»å†…å®¹ -->
  <scroll-view wx:else class="content" scroll-y>
    <!-- ä½ç½®å¡ç‰‡ -->
    <view class="location-card">
      <view class="location-header">
        <text class="location-icon">ğŸ“</text>
        <text class="location-title">å½“å‰ä½ç½®</text>
        <view class="relocate-btn" bindtap="relocate">
          <text class="relocate-icon">ğŸ”„</text>
          <text>é‡æ–°å®šä½</text>
        </view>
      </view>
      
      <view class="location-info">
        <text class="location-address">{{address || 'æ­£åœ¨è·å–åœ°å€...'}}</text>
        <text class="location-coords">{{latitude ? latitude.toFixed(6) + ', ' + longitude.toFixed(6) : ''}}</text>
      </view>

      <!-- åœ°å›¾é¢„è§ˆ -->
      <map
        class="location-map"
        latitude="{{latitude}}"
        longitude="{{longitude}}"
        scale="16"
        show-location="{{true}}"
        markers="{{latitude ? [{latitude: latitude, longitude: longitude, iconPath: '/images/marker.png', width: 28, height: 36}] : []}}">
      </map>
    </view>

    <!-- æ‰“å¡åœ°ç‚¹ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">æ‰“å¡åœ°ç‚¹</text>
        <view wx:if="{{nearbyPois.length > 0}}" class="nearby-btn" bindtap="showPoiPicker">
          <text>é™„è¿‘æ™¯ç‚¹</text>
          <text class="nearby-count">{{nearbyPois.length}}</text>
        </view>
      </view>

      <!-- å·²é€‰æ‹©çš„æ™¯ç‚¹ -->
      <view wx:if="{{selectedPoi}}" class="selected-poi">
        <view class="poi-info">
          <text class="poi-name">{{selectedPoi.name}}</text>
          <text class="poi-distance">{{selectedPoi.distance}}m</text>
        </view>
        <view class="clear-btn" bindtap="clearSelectedPoi">Ã—</view>
      </view>

      <!-- è¾“å…¥æ¡† -->
      <view wx:else class="input-box">
        <input 
          class="name-input" 
          placeholder="è¾“å…¥åœ°ç‚¹åç§°ï¼Œå¦‚ï¼šæ•…å®«åšç‰©é™¢"
          value="{{name}}"
          bindinput="onNameInput"
          maxlength="50" />
      </view>
    </view>

    <!-- ç…§ç‰‡ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">ç…§ç‰‡</text>
        <text class="section-sub">{{photos.length}}/9</text>
      </view>

      <view class="photo-grid">
        <!-- å·²é€‰ç…§ç‰‡ -->
        <view wx:for="{{photos}}" wx:key="index" class="photo-item">
          <image class="photo-img" src="{{item}}" mode="aspectFill" bindtap="previewPhoto" data-url="{{item}}" />
          <view class="photo-delete" catchtap="removePhoto" data-index="{{index}}">Ã—</view>
        </view>

        <!-- æ·»åŠ æŒ‰é’® -->
        <view wx:if="{{photos.length < 9}}" class="photo-add" bindtap="choosePhoto">
          <text class="add-icon">ğŸ“·</text>
          <text class="add-text">æ·»åŠ ç…§ç‰‡</text>
        </view>
      </view>
    </view>

    <!-- å¤‡æ³¨ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">å¤‡æ³¨</text>
      </view>

      <textarea 
        class="note-input"
        placeholder="è®°å½•è¿™ä¸€åˆ»çš„å¿ƒæƒ…..."
        value="{{note}}"
        bindinput="onNoteInput"
        maxlength="500"
        auto-height />
    </view>

    <!-- å ä½ -->
    <view class="bottom-space"></view>
  </scroll-view>

  <!-- æäº¤æŒ‰é’® -->
  <view class="submit-bar">
    <button 
      class="submit-btn {{submitting ? 'disabled' : ''}}" 
      bindtap="submit"
      disabled="{{submitting}}">
      <text wx:if="{{submitting}}">æäº¤ä¸­...</text>
      <text wx:else>ğŸ¯ æ‰“å¡</text>
    </button>
  </view>

  <!-- é™„è¿‘æ™¯ç‚¹é€‰æ‹©å™¨ -->
  <view wx:if="{{showPoiPicker}}" class="poi-picker">
    <view class="picker-mask" bindtap="hidePoiPicker"></view>
    <view class="picker-content">
      <view class="picker-header">
        <text class="picker-title">é™„è¿‘æ™¯ç‚¹</text>
        <view class="picker-close" bindtap="hidePoiPicker">Ã—</view>
      </view>
      <scroll-view class="picker-list" scroll-y>
        <view 
          wx:for="{{nearbyPois}}" 
          wx:key="id" 
          class="poi-item"
          bindtap="selectPoi"
          data-index="{{index}}">
          <view class="poi-main">
            <text class="poi-name">{{item.name}}</text>
            <text class="poi-type">{{item.type}}</text>
          </view>
          <view class="poi-sub">
            <text class="poi-address">{{item.address}}</text>
            <text class="poi-distance">{{item.distance}}m</text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>
