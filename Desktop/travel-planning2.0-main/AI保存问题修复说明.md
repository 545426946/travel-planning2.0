# AI è¡Œç¨‹ä¿å­˜é—®é¢˜ä¿®å¤è¯´æ˜

## ğŸ› å·²ä¿®å¤çš„é—®é¢˜

### 1. å­—æ®µåä¸åŒ¹é…é—®é¢˜
**é—®é¢˜**: `parseAIResponseToPlan` è¿”å› `budget` å­—æ®µï¼Œä½†æ•°æ®åº“æœŸæœ› `total_budget`
**ä¿®å¤**: åœ¨ `ai-integration.js` çš„ `savePlanOnly` æ–¹æ³•ä¸­ä¿®æ­£äº†å­—æ®µæ˜ å°„

### 2. æ•°æ®ç±»å‹é—®é¢˜  
**é—®é¢˜**: `interests` å’Œ `tags` å­—æ®µæœŸæœ›æ•°ç»„ï¼Œä½†å¯èƒ½æ¥æ”¶åˆ°å­—ç¬¦ä¸²
**ä¿®å¤**: æ·»åŠ äº†ç±»å‹è½¬æ¢é€»è¾‘ï¼Œç¡®ä¿æ•°æ®ç±»å‹æ­£ç¡®

### 3. ç©ºå€¼ä¿æŠ¤é—®é¢˜
**é—®é¢˜**: `planData` å¯èƒ½ä¸º nullï¼Œå¯¼è‡´ä¿å­˜å¤±è´¥
**ä¿®å¤**: åœ¨ `showPlanResultWithOptions` ä¸­æ·»åŠ äº†ç©ºå€¼æ£€æŸ¥å’Œé»˜è®¤å€¼ç”Ÿæˆ

### 4. æ•°æ®å®Œæ•´æ€§é—®é¢˜
**é—®é¢˜**: æŸäº›å¿…éœ€å­—æ®µå¯èƒ½ç¼ºå¤±
**ä¿®å¤**: ä¸ºæ‰€æœ‰å­—æ®µæ·»åŠ äº†é»˜è®¤å€¼

## ğŸ› ï¸ å…·ä½“ä¿®å¤å†…å®¹

### 1. utils/ai-integration.js ä¿®å¤
```javascript
// ä¿®å¤å‰
total_budget: planData.budget,  // å¯èƒ½ undefined
interests: planData.interests,  // å¯èƒ½æ˜¯å­—ç¬¦ä¸²è€Œéæ•°ç»„

// ä¿®å¤å  
total_budget: planData.budget || 0,
interests: Array.isArray(planData.interests) ? planData.interests : JSON.parse(planData.interests || '[]'),
```

### 2. pages/ai-plan/ai-plan.js ä¿®å¤
```javascript
// æ·»åŠ äº† planData ç©ºå€¼æ£€æŸ¥
if (!planData) {
  // åˆ›å»ºé»˜è®¤çš„ planData å¯¹è±¡
  planData = { /* åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ */ }
}
```

### 3. è°ƒè¯•ä¿¡æ¯å¢å¼º
- æ·»åŠ äº†è¯¦ç»†çš„ console.log è¾“å‡º
- å¯ä»¥åœ¨å¼€å‘è€…å·¥å…·æ§åˆ¶å°æŸ¥çœ‹å®Œæ•´çš„æ•°æ®æµè½¬è¿‡ç¨‹

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³•1ï¼šä½¿ç”¨è°ƒè¯•é¡µé¢
1. è®¿é—® `/pages/ai-plan/ai-plan-debug` 
2. ç‚¹å‡»"ğŸ“ å¡«å……æµ‹è¯•æ•°æ®"
3. ç‚¹å‡»"ğŸ¤– ä»…æµ‹è¯•AIç”Ÿæˆ"
4. é€‰æ‹©"æµ‹è¯•ä¿å­˜"æŸ¥çœ‹è¯¦ç»†è¿‡ç¨‹

### æ–¹æ³•2ï¼šä½¿ç”¨åŸå§‹é¡µé¢
1. è®¿é—® AI è§„åˆ’é¡µé¢
2. å¡«å†™ç›®çš„åœ°ã€å¤©æ•°ã€äººæ•°ã€é¢„ç®—ç­‰åŸºæœ¬ä¿¡æ¯
3. æäº¤ç”Ÿæˆè¡Œç¨‹
4. é€‰æ‹©ä¿å­˜è¡Œç¨‹
5. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºäº†è§£ä¿å­˜è¿‡ç¨‹

## ğŸ” æ•…éšœæ’æŸ¥æ­¥éª¤

å¦‚æœä»ç„¶æ— æ³•ä¿å­˜ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š

### 1. æ£€æŸ¥åŸŸåé…ç½®
ç¡®ä¿å·²åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°é…ç½®ï¼š
- `https://hmnjuntvubqvbpeyqoxw.supabase.co`
- `https://api.mistral.ai`

### 2. æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
```javascript
// åœ¨æ§åˆ¶å°æ‰§è¡Œ
const Auth = require('./utils/auth').Auth
console.log('å½“å‰ç”¨æˆ·ID:', Auth.getCurrentUserId())
console.log('ç™»å½•çŠ¶æ€:', Auth.isLoggedIn())
```

### 3. æ£€æŸ¥AIå“åº”
```javascript
// æŸ¥çœ‹ AI æ˜¯å¦æ­£å¸¸è¿”å›å“åº”
// åœ¨æ§åˆ¶å°æŸ¥æ‰¾ "AIå“åº”æˆåŠŸ" æˆ– "AIå“åº”å¤±è´¥" çš„æ—¥å¿—
```

### 4. æ£€æŸ¥æ•°æ®ç»“æ„
```javascript
// æŸ¥çœ‹ planData çš„å®Œæ•´ç»“æ„
// åœ¨æ§åˆ¶å°æŸ¥æ‰¾ "å®Œæ•´çš„planDataå¯¹è±¡" çš„æ—¥å¿—
```

### 5. æ£€æŸ¥æ•°æ®åº“è¿æ¥
```javascript
// æŸ¥çœ‹æ•°æ®åº“æ“ä½œæ—¥å¿—
// åœ¨æ§åˆ¶å°æŸ¥æ‰¾ "å‡†å¤‡å‘é€åˆ°æ•°æ®åº“çš„payload" çš„æ—¥å¿—
```

## ğŸš€ ä½¿ç”¨è¯´æ˜

### å¿«é€Ÿæµ‹è¯•
```javascript
// åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æ§åˆ¶å°è¿è¡Œä»¥ä¸‹ä»£ç ï¼š
const pages = getCurrentPages()
const currentPage = pages[pages.length - 1]
if (currentPage && currentPage.fillTestData) {
  currentPage.fillTestData()
  console.log('âœ… æµ‹è¯•æ•°æ®å·²å¡«å……')
}
```

### æ‰‹åŠ¨è§¦å‘ä¿å­˜
```javascript
// åœ¨æ§åˆ¶å°æ‰‹åŠ¨è§¦å‘ä¿å­˜ï¼ˆå¦‚æœæœ‰ AI å“åº”æ•°æ®ï¼‰
if (currentPage && currentPage.currentPlanData) {
  currentPage.saveCurrentPlan()
  console.log('ğŸ”„ æ‰‹åŠ¨è§¦å‘ä¿å­˜')
}
```

## ğŸ“‹ æ£€æŸ¥æ¸…å•

- [ ] å¾®ä¿¡å…¬ä¼—å¹³å°åŸŸåç™½åå•å·²é…ç½®
- [ ] ç”¨æˆ·å·²ç™»å½•ä¸”è·å–åˆ° userId
- [ ] AI API èƒ½å¤Ÿæ­£å¸¸å“åº”
- [ ] planData å¯¹è±¡åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] æ²¡æœ‰æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

## ğŸ’¡ é¢å¤–å»ºè®®

1. **å¤‡ä»½æ•°æ®**: åœ¨æµ‹è¯•é‡è¦æ•°æ®å‰ï¼Œå…ˆåœ¨ Supabase æ§åˆ¶å°å¤‡ä»½
2. **åˆ†æ­¥æµ‹è¯•**: å…ˆæµ‹è¯•AIç”Ÿæˆï¼Œå†æµ‹è¯•ä¿å­˜åŠŸèƒ½
3. **æŸ¥çœ‹ç½‘ç»œ**: ä½¿ç”¨ Network é¢æ¿æŸ¥çœ‹ HTTP è¯·æ±‚çŠ¶æ€
4. **æ¸…ç†ç¼“å­˜**: é‡åˆ°å¥‡æ€ªé—®é¢˜æ—¶ï¼Œæ¸…é™¤å¼€å‘è€…å·¥å…·ç¼“å­˜

---

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤ä»æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. æ§åˆ¶å°å®Œæ•´é”™è¯¯ä¿¡æ¯
2. Network é¢æ¿çš„è¯·æ±‚/å“åº”è¯¦æƒ…
3. å½“å‰ç™»å½•çš„ç”¨æˆ·ID
4. å¡«å†™çš„è¡¨å•æ•°æ®å†…å®¹