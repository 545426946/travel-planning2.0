# 微信小程序域名白名单配置指南

## 🚨 必需配置的域名

为了让 AI 智能规划功能正常工作，需要在微信公众平台配置以下域名：

### 1. Supabase 数据库域名
```
https://hmnjuntvubqvbpeyqoxw.supabase.co
```

### 2. Mistral AI API 域名
```
https://api.mistral.ai
```

### 3. OpenAI API 域名（可选）
```
https://api.openai.com
```

## 📋 配置步骤

### 步骤1：登录微信公众平台
- 访问：https://mp.weixin.qq.com
- 使用小程序管理员账号登录
- 选择你的小程序（AppID: wxb9ca37c30f43d5b8）

### 步骤2：进入开发设置
1. 点击左侧菜单 "开发"
2. 点击 "开发管理"
3. 点击 "开发设置"

### 步骤3：配置服务器域名
在 "服务器域名" 部分：

#### request 合法域名
添加以下域名：
- `https://hmnjuntvubqvbpeyqoxw.supabase.co`
- `https://api.mistral.ai`

#### uploadFile 合法域名
如果需要文件上传功能：
- `https://hmnjuntvubqvbpeyqoxw.supabase.co`

#### downloadFile 合法域名
如果需要文件下载功能：
- `https://hmnjuntvubqvbpeyqoxw.supabase.co`

### 步骤4：保存配置
点击 "保存" 或 "确定" 按钮保存配置

### 步骤5：在开发者工具中检查
1. 重新打开微信开发者工具
2. 确保 project.config.json 中 `urlCheck` 设置为 `true`
3. 重新编译项目

## 🔧 配置验证

配置完成后，测试以下功能：

### 1. 登录功能测试
- 使用账号：`admin/123456`
- 检查是否能成功连接 Supabase

### 2. AI 规划功能测试
- 进入 AI 智能规划页面
- 输入目的地和需求
- 检查是否能调用 Mistral AI API

### 3. 数据保存测试
- AI 规划完成后
- 检查行程是否能保存到数据库

## 🆘 问题排查

### 问题1：仍然出现 "url not in domain list" 错误
**解决方案：**
1. 检查域名是否完全正确（包括 https://）
2. 确认配置已保存
3. 重启微信开发者工具
4. 清除缓存后重新编译

### 问题2：AI API 调用失败
**可能原因：**
1. API Key 无效
2. 域名未正确配置
3. 网络连接问题

**解决方案：**
1. 检查 Mistral AI API Key 是否正确
2. 确认 `https://api.mistral.ai` 已添加到白名单
3. 查看开发者工具 Network 面板检查请求状态

### 问题3：数据保存失败
**可能原因：**
1. Supabase 连接问题
2. 数据格式错误
3. 权限问题

**解决方案：**
1. 检查 Supabase 域名配置
2. 查看 Console 错误信息
3. 检查 Supabase 数据库表结构

## 🎯 配置完成后的功能

配置完成后，以下功能将完全可用：

✅ **用户登录/注册**
✅ **AI 智能行程规划**
✅ **行程数据保存**
✅ **行程列表查看**
✅ **行程详情编辑**
✅ **用户偏好管理**

## 📱 优先级建议

1. **高优先级**：必须配置 Supabase 域名
2. **高优先级**：必须配置 Mistral AI 域名
3. **低优先级**：OpenAI 域名（备用 AI 服务）

---

## ⚠️ 重要提醒

1. **正式发布前**必须配置域名白名单
2. **开发期间**可以临时设置 `urlCheck: false`
3. **测试环境**建议使用真实域名测试
4. **API Key** 请妥善保管，不要提交到代码仓库