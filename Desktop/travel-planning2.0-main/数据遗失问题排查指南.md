# "æ•°æ®é—å¤±" é—®é¢˜æ’æŸ¥æŒ‡å—

## ğŸ” é—®é¢˜ç°è±¡
è®¿é—®è¡Œç¨‹åˆ—è¡¨æ—¶æ˜¾ç¤º "æ•°æ®é—å¤±"ï¼Œé€šå¸¸è¡¨ç¤ºï¼š
- âœ… ç½‘ç»œè¿æ¥æ­£å¸¸
- âœ… æ•°æ®åº“å¯è®¿é—®
- âŒ æŸ¥è¯¢æ¡ä»¶æ— åŒ¹é…ç»“æœ

## ğŸ› ï¸ å¿«é€Ÿæ’æŸ¥å·¥å…·

### 1. ä½¿ç”¨æ•°æ®è°ƒè¯•é¡µé¢
è®¿é—®ï¼š`/pages/travel-plans/data-debug`

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- ğŸ” æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
- ğŸ—„ï¸ æµ‹è¯•æ•°æ®åº“è¿æ¥
- ğŸ“‹ æŸ¥è¯¢ç”¨æˆ·è¡Œç¨‹æ•°æ®
- ğŸŒ æŸ¥çœ‹æ‰€æœ‰æ•°æ®ï¼ˆç®¡ç†å‘˜è§†è§’ï¼‰
- ğŸ†• åˆ›å»ºæµ‹è¯•æ•°æ®
- ğŸ—‘ï¸ æ¸…ç†æµ‹è¯•æ•°æ®

### 2. æ‰‹åŠ¨æ£€æŸ¥æ­¥éª¤

#### æ­¥éª¤1: æ£€æŸ¥ç”¨æˆ·ç™»å½•
åœ¨å¼€å‘è€…å·¥å…·æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
const Auth = require('./utils/auth').Auth
console.log('ç™»å½•çŠ¶æ€:', Auth.isLoggedIn())
console.log('å½“å‰ç”¨æˆ·:', Auth.getCurrentUser())
console.log('ç”¨æˆ·ID:', Auth.getCurrentUserId())
```

#### æ­¥éª¤2: æ£€æŸ¥æ•°æ®æŸ¥è¯¢
```javascript
const supabase = require('./utils/supabase').supabase
const userId = Auth.getCurrentUserId()

// æŸ¥è¯¢è¯¥ç”¨æˆ·çš„æ‰€æœ‰è¡Œç¨‹
supabase
  .from('travel_plans')
  .select('*')
  .eq('user_id', userId)
  .then(result => {
    console.log('æŸ¥è¯¢ç»“æœ:', result)
    console.log('æ•°æ®æ¡æ•°:', result.data?.length || 0)
  })
```

## ğŸ¯ å¸¸è§åŸå› åŠè§£å†³æ–¹æ¡ˆ

### åŸå› 1: ç”¨æˆ·IDä¸åŒ¹é…
**ç°è±¡**: ç”¨æˆ·ç™»å½•äº†ï¼Œä½†æŸ¥è¯¢ä¸åˆ°æ•°æ®
**æ’æŸ¥**: 
1. ä½¿ç”¨è°ƒè¯•é¡µé¢æ£€æŸ¥ç”¨æˆ·ID
2. åœ¨ Supabase æ§åˆ¶å°æŸ¥è¯¢è¯¥ç”¨æˆ·çš„è¡Œç¨‹æ•°æ®
3. ç¡®è®¤ç”¨æˆ·IDæ ¼å¼ä¸€è‡´ï¼ˆå­—ç¬¦ä¸² vs æ•°å­—ï¼‰

**è§£å†³æ–¹æ¡ˆ**:
```javascript
// åœ¨ travel-plans.js ä¸­æ·»åŠ è°ƒè¯•ä¿¡æ¯
const userId = Auth.getCurrentUserId()
console.log('æŸ¥è¯¢ç”¨æˆ·ID:', userId, 'ç±»å‹:', typeof userId)
```

### åŸå› 2: æ•°æ®ç¡®å®ä¸å­˜åœ¨
**ç°è±¡**: æ•°æ®åº“ä¸­æ²¡æœ‰è¯¥ç”¨æˆ·çš„è¡Œç¨‹
**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨è°ƒè¯•é¡µé¢åˆ›å»ºæµ‹è¯•æ•°æ®
2. é€šè¿‡ AI æ™ºèƒ½è§„åˆ’åˆ›å»ºæ–°è¡Œç¨‹

### åŸå› 3: çŠ¶æ€ç­›é€‰é—®é¢˜
**ç°è±¡**: æ•°æ®å­˜åœ¨ä½†è¢«çŠ¶æ€ç­›é€‰è¿‡æ»¤æ‰
**æ’æŸ¥**:
```javascript
// æ£€æŸ¥å½“å‰çš„ç­›é€‰çŠ¶æ€
const pages = getCurrentPages()
const currentPage = pages[pages.length - 1]
console.log('å½“å‰ç­›é€‰çŠ¶æ€:', currentPage.data.filterStatus)
```

**è§£å†³æ–¹æ¡ˆ**:
1. åœ¨è¡Œç¨‹é¡µé¢åˆ‡æ¢åˆ°"å…¨éƒ¨"çŠ¶æ€
2. æˆ–æ£€æŸ¥è¡Œç¨‹çš„ status å­—æ®µæ˜¯å¦æ­£ç¡®

### åŸå› 4: æ•°æ®åº“è¡¨ç»“æ„é—®é¢˜
**ç°è±¡**: æŸ¥è¯¢å¤±è´¥ä½†è¿æ¥æ­£å¸¸
**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ travel_plans è¡¨æ˜¯å¦å­˜åœ¨
2. ç¡®è®¤å­—æ®µåæ­£ç¡®
3. æ‰§è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬

## ğŸ”§ ä¿®å¤ä»£ç ç¤ºä¾‹

### 1. å¢å¼ºé”™è¯¯å¤„ç†
```javascript
// åœ¨ travel-plans.js çš„ doLoadTravelPlans æ–¹æ³•ä¸­
async doLoadTravelPlans() {
  const userId = Auth.getCurrentUserId()
  console.log('ğŸ” æŸ¥è¯¢ç”¨æˆ·è¡Œç¨‹ï¼Œç”¨æˆ·ID:', userId, 'ç±»å‹:', typeof userId)
  
  if (!userId) {
    wx.showModal({
      title: 'æœªç™»å½•',
      content: 'è¯·å…ˆç™»å½•åæŸ¥çœ‹è¡Œç¨‹',
      showCancel: false
    })
    return
  }

  // ... å…¶ä»–ä»£ç 
}
```

### 2. æ·»åŠ ç©ºæ•°æ®å¤„ç†
```javascript
// åœ¨è·å–æ•°æ®å
if (!validData || validData.length === 0) {
  console.log('ğŸ“­ è¯¥ç”¨æˆ·æš‚æ— è¡Œç¨‹æ•°æ®')
  this.setData({ 
    travelPlans: [],
    loading: false 
  })
  
  // æ˜¾ç¤ºå‹å¥½æç¤º
  wx.showToast({
    title: 'æš‚æ— è¡Œç¨‹ï¼Œå¿«å»åˆ›å»ºå§',
    icon: 'none'
  })
  return
}
```

### 3. è°ƒè¯•æ•°æ®åº“æŸ¥è¯¢
```javascript
// æ·»åŠ è¯¦ç»†çš„æŸ¥è¯¢æ—¥å¿—
let query = supabase
  .from('travel_plans')
  .select('*')
  .eq('user_id', String(userId)) // ç¡®ä¿ç±»å‹ä¸€è‡´

console.log('ğŸ“ SQLæŸ¥è¯¢æ¡ä»¶:')
console.log('  - user_id:', String(userId))
console.log('  - status:', this.data.filterStatus)

if (this.data.filterStatus !== 'all') {
  query = query.eq('status', this.data.filterStatus)
}

const result = await query
console.log('ğŸ“Š æŸ¥è¯¢ç»“æœ:', result)
```

## ğŸ“± Supabase æ§åˆ¶å°æ’æŸ¥

### 1. ç›´æ¥æŸ¥è¯¢ç”¨æˆ·æ•°æ®
```sql
-- æŸ¥è¯¢ç‰¹å®šç”¨æˆ·çš„æ‰€æœ‰è¡Œç¨‹
SELECT * FROM travel_plans 
WHERE user_id = 'ä½ çš„ç”¨æˆ·ID' 
ORDER BY created_at DESC;

-- æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
SELECT DISTINCT user_id, COUNT(*) as plan_count 
FROM travel_plans 
GROUP BY user_id;
```

### 2. æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
```sql
-- æ£€æŸ¥å¿…å¡«å­—æ®µ
SELECT id, title, user_id, status, created_at 
FROM travel_plans 
WHERE user_id IS NULL OR title IS NULL;

-- æ£€æŸ¥çŠ¶æ€å€¼
SELECT DISTINCT status FROM travel_plans;
```

## ğŸš¨ ç´§æ€¥ä¿®å¤

å¦‚æœé—®é¢˜ç´§æ€¥ï¼Œå¯ä»¥ä¸´æ—¶ä½¿ç”¨ä»¥ä¸‹æ–¹æ¡ˆï¼š

### 1. ç»•è¿‡ç”¨æˆ·IDæ£€æŸ¥ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
```javascript
// ä¸´æ—¶ä½¿ç”¨å›ºå®šç”¨æˆ·IDè¿›è¡Œæµ‹è¯•
const testUserId = 'your-test-user-id'
// const userId = Auth.getCurrentUserId()
const userId = testUserId
```

### 2. æ˜¾ç¤ºæ‰€æœ‰æ•°æ®ï¼ˆç®¡ç†å‘˜æ¨¡å¼ï¼‰
```javascript
// æŸ¥è¯¢æ‰€æœ‰è¡Œç¨‹ï¼Œä¸é™åˆ¶ç”¨æˆ·ï¼ˆä»…ç”¨äºè°ƒè¯•ï¼‰
const result = await supabase
  .from('travel_plans')
  .select('*')
  .order('created_at', { ascending: false })
  .limit(10)
```

## ğŸ“‹ æ£€æŸ¥æ¸…å•

- [ ] ç”¨æˆ·å·²ç™»å½•ä¸”èƒ½è·å–åˆ°æœ‰æ•ˆID
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] travel_plans è¡¨å­˜åœ¨ä¸”æœ‰æ•°æ®
- [ ] ç”¨æˆ·IDç±»å‹ä¸æ•°æ®åº“ä¸€è‡´
- [ ] çŠ¶æ€ç­›é€‰æ¡ä»¶æ­£ç¡®
- [ ] æ²¡æœ‰ç½‘ç»œé”™è¯¯
- [ ] åŸŸåç™½åå•å·²é…ç½®
- [ ] æƒé™è®¾ç½®æ­£ç¡®

## ğŸ’¡ é¢„é˜²æªæ–½

1. **æ•°æ®éªŒè¯**: ä¿å­˜æ—¶éªŒè¯å¿…å¡«å­—æ®µ
2. **ç±»å‹ä¸€è‡´æ€§**: ç¡®ä¿ç”¨æˆ·IDç±»å‹ä¸€è‡´
3. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯æç¤º
4. **æ—¥å¿—è®°å½•**: è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
5. **æ•°æ®å¤‡ä»½**: å®šæœŸå¤‡ä»½é‡è¦æ•°æ®

---

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤ä»æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. ç”¨æˆ·IDï¼ˆæ§åˆ¶å°è¾“å‡ºçš„å€¼ï¼‰
2. å®Œæ•´çš„é”™è¯¯ä¿¡æ¯
3. Supabase æ§åˆ¶å°çš„æŸ¥è¯¢ç»“æœ
4. è°ƒè¯•é¡µé¢çš„æ£€æŸ¥ç»“æœ